!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],e):e(t.d3={},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,o,i,r){"use strict";function u(t,e,n){this.k=t,this.x=e,this.y=n}function h(t){return t.__zoom||m}function s(){i.event.stopImmediatePropagation()}function c(){return!i.event.button}function a(){var t,e,n=this;return n instanceof SVGElement?(t=(n=n.ownerSVGElement||n).width.baseVal.value,e=n.height.baseVal.value):(t=n.clientWidth,e=n.clientHeight),[[0,0],[t,e]]}function f(){return this.__zoom||m}var l=function(t){return function(){return t}};u.prototype={constructor:u,scale:function(t){return 1===t?this:new u(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new u(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var m=new u(1,0,0);h.prototype=u.prototype;var p=function(){i.event.preventDefault(),i.event.stopImmediatePropagation()};t.zoom=function(){function t(t){t.on("wheel.zoom",g).on("mousedown.zoom",x).on("dblclick.zoom",k).on("touchstart.zoom",w).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",T).style("-webkit-tap-highlight-color","rgba(0,0,0,0)").property("__zoom",f)}function h(t,e){return(e=Math.max(X,Math.min(V,e)))===t.k?t:new u(e,t.x,t.y)}function m(t,e,n){var o=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return o===t.x&&i===t.y?t:new u(t.k,o,i)}function d(t,e){var n=t.invertX(e[0][0])-I,o=t.invertX(e[1][0])-P,i=t.invertY(e[0][1])-S,r=t.invertY(e[1][1])-j;return t.translate(o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o),r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r))}function v(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function y(t,e,n){t.on("start.zoom",function(){z(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){z(this,arguments).end()}).tween("zoom",function(){var t=arguments,o=z(this,t),i=E.apply(this,t),r=n||v(i),h=Math.max(i[1][0]-i[0][0],i[1][1]-i[0][1]),s=this.__zoom,c="function"==typeof e?e.apply(this,t):e,a=D(s.invert(r).concat(h/s.k),c.invert(r).concat(h/c.k));return function(t){if(1===t)t=c;else{var e=a(t),n=h/e[2];t=new u(n,r[0]-e[0]*n,r[1]-e[1]*n)}o.zoom(null,t)}})}function z(t,e){for(var n,o=0,i=G.length;o<i;++o)if((n=G[o]).that===t)return n;return new _(t,e)}function _(t,e){this.that=t,this.args=e,this.index=-1,this.active=0,this.extent=E.apply(t,e)}function g(){if(q.apply(this,arguments)){var t=z(this,arguments),e=this.__zoom,n=Math.max(X,Math.min(V,e.k*Math.pow(2,-i.event.deltaY*(i.event.deltaMode?120:1)/500))),o=i.mouse(this);if(t.wheel)t.mouse[0][0]===o[0]&&t.mouse[0][1]===o[1]||(t.mouse[1]=e.invert(t.mouse[0]=o)),clearTimeout(t.wheel);else{if(e.k===n)return;t.mouse=[o,e.invert(o)],r.interrupt(this),t.start()}p(),t.wheel=setTimeout(function(){t.wheel=null,t.end()},O),t.zoom("mouse",d(m(h(e,n),t.mouse[0],t.mouse[1]),t.extent))}}function x(){if(!Y&&q.apply(this,arguments)){var t=z(this,arguments),e=i.select(i.event.view).on("mousemove.zoom",function(){p(),t.moved=!0,t.zoom("mouse",d(m(t.that.__zoom,t.mouse[0]=i.mouse(t.that),t.mouse[1]),t.extent))},!0).on("mouseup.zoom",function(){e.on("mousemove.zoom mouseup.zoom",null),n.dragEnable(i.event.view,t.moved),p(),t.end()},!0),o=i.mouse(this);n.dragDisable(i.event.view),s(),t.mouse=[o,this.__zoom.invert(o)],r.interrupt(this),t.start()}}function k(){if(q.apply(this,arguments)){var e=this.__zoom,n=i.mouse(this),o=e.invert(n),r=d(m(h(e,e.k*(i.event.shiftKey?.5:2)),n,o),E.apply(this,arguments));p(),B>0?i.select(this).transition().duration(B).call(y,r,n):i.select(this).call(t.transform,r)}}function w(){if(q.apply(this,arguments)){var t,e,n,o,u=z(this,arguments),h=i.event.changedTouches,c=h.length;for(s(),e=0;e<c;++e)n=h[e],o=[o=touch(this,h,n.identifier),this.__zoom.invert(o),n.identifier],u.touch0?u.touch1||(u.touch1=o):(u.touch0=o,t=!0);if(b&&(b=clearTimeout(b),!u.touch1))return u.end(),void((o=i.select(this).on("dblclick.zoom"))&&o.apply(this,arguments));t&&(b=setTimeout(function(){b=null},K),r.interrupt(this),u.start())}}function M(){if(q.apply(this,arguments)){var t,e,n,o,r=z(this,arguments),u=i.event.changedTouches,s=u.length;for(p(),b&&(b=clearTimeout(b)),t=0;t<s;++t)e=u[t],n=touch(this,u,e.identifier),r.touch0&&r.touch0[2]===e.identifier?r.touch0[0]=n:r.touch1&&r.touch1[2]===e.identifier&&(r.touch1[0]=n);if(e=r.that.__zoom,r.touch1){var c=r.touch0[0],a=r.touch0[1],f=r.touch1[0],l=r.touch1[1],v=(v=f[0]-c[0])*v+(v=f[1]-c[1])*v,y=(y=l[0]-a[0])*y+(y=l[1]-a[1])*y;e=h(e,Math.sqrt(v/y)),n=[(c[0]+f[0])/2,(c[1]+f[1])/2],o=[(a[0]+l[0])/2,(a[1]+l[1])/2]}else{if(!r.touch0)return;n=r.touch0[0],o=r.touch0[1]}r.zoom("touch",d(m(e,n,o),r.extent))}}function T(){var t,e,n=z(this,arguments),o=i.event.changedTouches,r=o.length;for(s(),Y&&clearTimeout(Y),Y=setTimeout(function(){Y=null},K),t=0;t<r;++t)e=o[t],n.touch0&&n.touch0[2]===e.identifier?delete n.touch0:n.touch1&&n.touch1[2]===e.identifier&&delete n.touch1;n.touch1&&!n.touch0&&(n.touch0=n.touch1,delete n.touch1),n.touch0||n.end()}var b,Y,q=c,E=a,X=0,V=1/0,I=-V,P=V,S=I,j=P,B=250,D=o.interpolateZoom,G=[],H=e.dispatch("start","zoom","end"),K=500,O=150;return t.transform=function(t,e){var n=t.selection?t.selection():t;n.property("__zoom",f),t!==n?y(t,e):n.interrupt().each(function(){z(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},t.scaleBy=function(e,n){t.scaleTo(e,function(){return this.__zoom.k*("function"==typeof n?n.apply(this,arguments):n)})},t.scaleTo=function(e,n){t.transform(e,function(){var t=E.apply(this,arguments),e=this.__zoom,o=v(t),i=e.invert(o);return d(m(h(e,"function"==typeof n?n.apply(this,arguments):n),o,i),t)})},t.translateBy=function(e,n,o){t.transform(e,function(){return d(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof o?o.apply(this,arguments):o),E.apply(this,arguments))})},_.prototype={start:function(){return 1==++this.active&&(this.index=G.push(this)-1,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(G.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(e){i.customEvent(new function(t,e,n){this.target=t,this.type=e,this.transform=n}(t,e,this.that.__zoom),H.apply,H,[e,this.that,this.args])}},t.filter=function(e){return arguments.length?(q="function"==typeof e?e:l(!!e),t):q},t.extent=function(e){return arguments.length?(E="function"==typeof e?e:l([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),t):E},t.scaleExtent=function(e){return arguments.length?(X=+e[0],V=+e[1],t):[X,V]},t.translateExtent=function(e){return arguments.length?(I=+e[0][0],P=+e[1][0],S=+e[0][1],j=+e[1][1],t):[[I,S],[P,j]]},t.duration=function(e){return arguments.length?(B=+e,t):B},t.interpolate=function(e){return arguments.length?(D=e,t):D},t.on=function(){var e=H.on.apply(H,arguments);return e===H?t:e},t},t.zoomTransform=h,t.zoomIdentity=m,Object.defineProperty(t,"__esModule",{value:!0})});